@model Shefaa_ICU.ViewModels.ProfileViewModel
@{
    ViewData["Title"] = "My Profile";
    ViewData["PageTitle"] = "My Profile";
    ViewData["ActivePage"] = "Profile";
    ViewData["HideSearch"] = true;
}

<div class="page-header" data-animate>
    <div>
        <p class="page-eyebrow">Account</p>
        <h2>My Profile</h2>
        <p class="page-subtitle">Review your contact details and manage security settings.</p>
    </div>
    <div class="page-actions">
        <a class="btn btn-soft btn-icon" href="#security" onclick="switchTab('security'); return false;">
            <i class="fas fa-shield-alt"></i>
            Security
        </a>
        <form method="post" action="@Url.Action("UploadProfilePhoto", "Profile")" enctype="multipart/form-data" style="display:inline;" id="avatarUploadForm">
            @Html.AntiForgeryToken()
            <input type="file" id="photoInput" name="photo" accept="image/*" style="display:none;" onchange="document.getElementById('avatarUploadForm').submit();">
            <button class="btn btn-primary btn-icon" type="button" onclick="document.getElementById('photoInput').click();">
                <i class="fas fa-camera"></i>
                Update Avatar
            </button>
        </form>
    </div>
</div>

<div class="card profile-header-card mb-4 delay-1" data-animate>
    <div class="profile-cover"></div>
    <div class="profile-header-content">
        <div class="profile-avatar-section">
            <div class="profile-avatar-wrapper">
                @if (Model.ProfilePhotoPath != null)
                {
                    <img src="@Model.ProfilePhotoPath" alt="Profile" class="profile-avatar" id="profileAvatar">
                }
                else
                {
                    <img src="https://ui-avatars.com/api/?name=@(Model.Name ?? "User")&background=6366F1&color=fff&size=120"
                         alt="Profile" class="profile-avatar" id="profileAvatar">
                }
                <button class="avatar-edit-btn" type="button" onclick="changeAvatar()">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
            <div class="profile-header-info">
                <h2 id="profileName">Loading...</h2>
                <p class="profile-role" id="profileRole">Role</p>
                <p class="profile-email" id="profileEmail">email@example.com</p>
            </div>
        </div>
        <div class="profile-stats">
            <div class="stat-item">
                <h4 id="memberSince">0</h4>
                <p>Days Active</p>
            </div>
            <div class="stat-item">
                <h4 id="lastLogin">-</h4>
                <p>Last Login</p>
            </div>
        </div>
        @* Data: populate with current staff user info *@
    </div>
</div>

<ul class="nav nav-tabs mb-4 delay-2" id="profileTabs" data-animate>
    <li class="nav-item">
        <a class="nav-link active" href="#personalInfo" onclick="switchTab('personalInfo'); return false;">
            <i class="fas fa-user"></i> Personal Information
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#accountSettings" onclick="switchTab('accountSettings'); return false;">
            <i class="fas fa-cog"></i> Account Settings
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#security" onclick="switchTab('security'); return false;">
            <i class="fas fa-shield-alt"></i> Security
        </a>
    </li>
    <li class="nav-item">
    </li>
</ul>

<div class="tab-content delay-3" data-animate>
    <div class="tab-pane fade show active" id="personalInfo">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-user-edit"></i> Edit Personal Information</h5>
            </div>
            <div class="card-body">
                <form method="post" action="@Url.Action("UpdatePersonalInfo", "Profile")" id="personalInfoForm">
                    @Html.AntiForgeryToken()
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="form-label" for="Name">Full Name *</label>
                            <input type="text" class="form-control" id="Name" name="Name" value="@Model.Name" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="Email">Email Address *</label>
                            <input type="email" class="form-control" id="Email" name="Email" value="@Model.Email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="PhoneNumber">Phone Number</label>
                            <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" value="@Model.PhoneNumber">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Role</label>
                            <input type="text" class="form-control" value="@Model.Role" disabled>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="Specialty">Department/Specialty</label>
                            <input type="text" class="form-control" id="Specialty" name="Specialty" value="@Model.Specialty">
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="location.reload()">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </form>
                @* Data: form should bind to current Staff profile *@
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="accountSettings">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-cog"></i> Account Settings</h5>
            </div>
            <div class="card-body">
                <form method="post" action="@Url.Action("UpdateAccountSettings", "Profile")" id="accountSettingsForm">
                    @Html.AntiForgeryToken()
                    <div class="settings-group">
                        <h6>Language & Region</h6>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Language</label>
                                <select class="form-select" id="accountLanguage">
                                    <option value="en" selected>English</option>
                                    <option value="ar">Arabic</option>
                                    <option value="fr">French</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Timezone</label>
                                <select class="form-select" id="accountTimezone">
                                    <option value="utc">UTC</option>
                                    <option value="est">Eastern Time (EST)</option>
                                    <option value="pst">Pacific Time (PST)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h6>Privacy Settings</h6>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="profileVisibility" checked>
                            <label class="form-check-label" for="profileVisibility">
                                Make my profile visible to other staff members
                            </label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="showOnlineStatus" checked>
                            <label class="form-check-label" for="showOnlineStatus">
                                Show my online status
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Preferences
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="security">
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-key"></i> Change Password</h5>
            </div>
            <div class="card-body">
                <form method="post" action="@Url.Action("ChangePassword", "Profile")" id="changePasswordForm">
                    @Html.AntiForgeryToken()
                    <div class="mb-3">
                        <label class="form-label" for="CurrentPassword">Current Password</label>
                        <input type="password" class="form-control" id="CurrentPassword" name="CurrentPassword" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="NewPassword">New Password</label>
                        <input type="password" class="form-control" id="NewPassword" name="NewPassword" required minlength="8">
                        <small class="text-muted">Minimum 8 characters</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="ConfirmPassword">Confirm New Password</label>
                        <input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-lock"></i> Update Password
                    </button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-shield-alt"></i> Two-Factor Authentication</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Add an extra layer of security to your account</p>
                <button class="btn btn-outline-primary">
                    <i class="fas fa-mobile-alt"></i> Enable 2FA
                </button>
            </div>
        </div>
    </div>

</div>

@Html.AntiForgeryToken()

@section Scripts {
    <script>
        // Pass profile data to JavaScript
        @if (Model != null)
        {
            <text>
            window.__profileData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(new {
                name = Model.Name,
                role = Model.Role,
                email = Model.Email ?? "",
                phoneNumber = Model.PhoneNumber ?? "",
                specialty = Model.Specialty ?? "",
                profilePhotoPath = Model.ProfilePhotoPath ?? "",
                daysActive = Model.DaysActive,
                lastLogin = Model.LastLogin
            }));
            </text>
        }
        else
        {
            <text>
            console.error('Profile data not available');
            </text>
        }
    </script>
    <script src="~/js/profile.js" asp-append-version="true"></script>
}

