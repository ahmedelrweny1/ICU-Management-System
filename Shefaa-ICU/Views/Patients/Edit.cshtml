@using Shefaa_ICU.Models
@{
    ViewData["Title"] = "Edit Patient";
    ViewData["PageTitle"] = "Edit Patient";
    ViewData["ActivePage"] = "Patients";
    
    var patient = ViewBag.Patient as Patient;
}

<div class="page-header" data-animate>
    <div>
        <p class="page-eyebrow">Patients</p>
        <h2>Edit Patient</h2>
        <p class="page-subtitle">Update patient information</p>
    </div>
    <div class="page-actions">
        <a class="btn btn-soft btn-icon" asp-controller="Patients" asp-action="Index">
            <i class="fas fa-arrow-left"></i>
            Back to Patients
        </a>
    </div>
</div>

<div class="card delay-1" data-animate>
    <div class="card-body">
        @if (patient != null)
        {
            <form method="post" action="@Url.Action("Update", "Patients", new { id = patient.ID })">
                @Html.AntiForgeryToken()
                <input type="hidden" name="ID" value="@patient.ID" />
                <input type="hidden" name="Code" value="@patient.Code" />

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label" for="Name">Full Name *</label>
                        <input type="text" class="form-control" id="Name" name="Name" value="@patient.Name" required />
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label" for="Age">Age *</label>
                        <input type="number" class="form-control" id="Age" name="Age" value="@patient.Age" min="0" max="120" required />
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label" for="Gender">Gender *</label>
                        <select class="form-select" id="Gender" name="Gender" required>
                            <option value="">Select</option>
                            <option value="0" selected="@(patient.Gender == Gender.Male)">Male</option>
                            <option value="1" selected="@(patient.Gender == Gender.Female)">Female</option>
                            <option value="2" selected="@(patient.Gender == Gender.Other)">Other</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label" for="RoomId">Room</label>
                        <select class="form-select" id="RoomId" name="RoomId">
                            <option value="">Select Room</option>
                            @if (ViewBag.AllRooms != null)
                            {
                                foreach (var room in ViewBag.AllRooms)
                                {
                                    <option value="@room.ID" selected="@(patient.RoomId == room.ID)">@room.Number</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label" for="Condition">Condition *</label>
                        <select class="form-select" id="Condition" name="Condition" required>
                            <option value="">Select Condition</option>
                            <option value="Stable" selected="@(patient.Condition == "Stable")">Stable</option>
                            <option value="Moderate" selected="@(patient.Condition == "Moderate")">Moderate</option>
                            <option value="Critical" selected="@(patient.Condition == "Critical")">Critical</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label" for="AdmissionDate">Admission Date</label>
                        <input type="date" class="form-control" id="AdmissionDate" name="AdmissionDate" value="@patient.AdmissionDate.ToString("yyyy-MM-dd")" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label" for="EmergencyContact">Emergency Contact</label>
                        <input type="text" class="form-control" id="EmergencyContact" name="EmergencyContact" value="@patient.EmergencyContact" placeholder="Name - Phone Number" />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="Complaint">Chief Complaint</label>
                    <textarea class="form-control" id="Complaint" name="Complaint" rows="2">@patient.Complaint</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="MedicalHistory">Medical History</label>
                    <textarea class="form-control" id="MedicalHistory" name="MedicalHistory" rows="3">@patient.MedicalHistory</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="Diagnosis">Diagnosis</label>
                    <textarea class="form-control" id="Diagnosis" name="Diagnosis" rows="2">@patient.Diagnosis</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="Treatment">Treatment Plan</label>
                    <textarea class="form-control" id="Treatment" name="Treatment" rows="2">@patient.Treatment</textarea>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Patient
                    </button>
                    <a class="btn btn-secondary" asp-controller="Patients" asp-action="Index">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        }
        else
        {
            <div class="alert alert-danger">
                Patient not found.
            </div>
            <a class="btn btn-secondary" asp-controller="Patients" asp-action="Index">Back to Patients</a>
        }
    </div>
</div>

